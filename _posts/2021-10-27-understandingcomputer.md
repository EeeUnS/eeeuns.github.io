---
layout: post
title:  "C가 컴퓨터에서 작동하는 방식"
date:   2021-10-27 19:26:01 +0900
tag: etc
---

대상 : C를 공부했지만 pointer에 대해서 이해가 잘 되지않아 문제를 겪고있고, 컴퓨터가 작동하는 방식을 좀 더 이해하기 위한 글.

# C언어의 컴파일 과정


<!--    컴파일 사진                   -->

리눅스 gcc에서 컴파일


요약하면 C언어는 

1. 전처리를 거쳐서 매크로를 처리한다.
2. 컴파일러를 통해서 어셈블리 언어로 변환한다.
3. 어셈블러를 통해서 목적파일로 변환한다.
4. 링커를 통해서 여러개의 목적파일을 하나의 실행파일로 변환한다.

윈도우 환경이라면 여기서 최종 파일로 .exe 확장자가 붙은 파일이 있을 것이다.
이것은 우리의 하드디스크나 ssd에 담겨져있는 단순한 파일이다.
이것을 컴퓨터가 어떻게 실행하는지 보자.

# 어셈블리어? 이진수?

CPU에게 내리는 명령어다. 이는 실제로 기계어와 1:1대응되며 cpu의 종류마다 실제 명령어가 달라지며 거기에 대응하는 기계어도 달라진다. 이 기계어들은 모두 이진수로 이어져있고, 컴파일 단계 거친후의 파일들은 모두 이진파일(binary file)로 존재한다. 앞으로 사진에 보이는 명령어는 모두 이진수를 어셈블리어로 해석해 이루어져있는걸로 생각하면 된다.

# 프로그램 실행하기

컴파일 결과로 우리의 디스크에 잠들어있는 실행파일은 실행할때 OS가 우리가 컴퓨터를 살때에 따지는 메모리(RAM)에 이 파일을 올린다. 프로그램은 메인메모리에 정보가 올라가 있다. cpu는 이 메인메모리에 있는 명령들을 직접 읽으면서 차례대로 수행한다.

그럼 이제 cpu와 메인메모리에 대해서 좀 더 알아볼 생각이다.

# 메모리와 주소, pointer

- 메모리에는 주소가 존재하고 거기마다 1byte의 저장소가 있어 그곳에 값을 저장할 수 있다. 1byte의 저장소는 8비트로 이루어져 총 8개의 2진수를 저장 할 수 있다.

혹시 이렇게 생긴 메모리 구조에 대해서 본적이 있는가?

가상메모리?

![image](/images/undestandingCpu/.png)

<!--    가상메모리 사진                   -->

프로세스마다 논리적으로 이런 구조를 가진다.
모든 프로세스가 동일한 메모리 구조에서 작동하게 하기위해서 논리적인 구조이다.
메모리 주소를 고정시켜서 여기에서 가리키는 주소값들을 가상메모리라하고 이는 실제 메모리를 가리키는 주소가 아니고 이 실제 메모리를 참조할때에 OS와 CPU에서 실제 메모리를 가리키게 변환과정을 거친다.
이 프로세스마다 메모리 구조는 쪼개져서 실제 메모리(일부는 하드디스크에도)에 할당된다.

![image](/images/undestandingCpu/.png)
<!--    물리메모리 사진                   -->

여기서 *pointer* 자료형은 이 프로세스의 가상메모리 주소값을 가리킨다.



이제 우리의 C언어가 실행파일이 되고 이 실행파일을 실행하면 메인메모리에 올라가는것까지 알게되었다. 이제 CPU는 이 메인메모리에 있는것을 어떻게 읽는지에 대해서 알아보자.

![image](/images/undestandingCpu/.png)
<!--    프로그램이 메모리에 올라간 사진                   -->

좌측은 주소(가상), 가운데는 그 주소에 저장소에 저장되어있는 이진수를 16진수로 나타낸 값 우측은 이 16진수로 나타난 값을 어셈블리어로 해석한 모습(해당 어셈블리어는 x86-64)
이제 이 기계어를 cpu가 한줄씩 차례대로 읽고 그에따라 작동한다. 하나의 16진수 값으로 4비트를 표현할 수 있고 16진수 두개의 값으론 8비트인 1byte를 나타낼 수 있다. 주소 계산을 해보면 첫번째 줄에 16진수 값 두개씩 세번 나타내고 다음 주솟값은 이전주솟값에 비해서 크기가 3증가 해 있음을 알 수 있다.









아직 이정도 얘기를 하면서 다 이해하지 못한 부분도 있을것이고 새로 생긴 궁금증도 있을것이다 이런 빈 공간은 앞으로 시스템 프로그래밍, 운영체제, 컴퓨터 구조를 학습하며 채워나가자.
